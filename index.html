<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assessoria Digital - Prioridades </title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            color: #333;
        }
        form {
            margin-bottom: 20px;
        }
        .item-container {
            margin-bottom: 10px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="range"] {
            width: 200px;
        }
        select {
            margin-left: 10px;
        }
        #chart {
            width: 100%;
            height: 400px;
        }
        #calculator {
            margin-top: 20px;
        }
        #listaTemposPorItem {
            list-style-type: none;
            padding: 0;
        }
        #listaTemposPorItem li {
            background-color: #f1f1f1;
            padding: 10px;
            margin-bottom: 5px;
            cursor: move;
        }
        .item-container.inactive {
            opacity: 0.5;
            pointer-events: none;
        }
        .item-container.inactive select {
            pointer-events: auto;
        }
    </style>
</head>
<body>
    <h1>Assessoria Digital - Prioridades</h1>
    <form id="itemForm">
        <div class="item-container">
            <label for="negocio">Negócio / Projeto: <span id="negocioValue">10</span>%</label>
            <input type="range" id="negocio" name="negocio" min="0" max="100" value="10" step="1">
            <select id="negocioPrioridade" onchange="toggleItemStatus(this)">
                <option value="0" selected>0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
        </div>

        <div class="item-container">
            <label for="nicho">Nicho / Público Alvo: <span id="nichoValue">10</span>%</label>
            <input type="range" id="nicho" name="nicho" min="0" max="100" value="10" step="1">
            <select id="nichoPrioridade" onchange="toggleItemStatus(this)">
                <option value="0" selected>0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
        </div>

        <div class="item-container">
            <label for="ticket">Aum. Ticket Médio: <span id="ticketValue">10</span>%</label>
            <input type="range" id="ticket" name="ticket" min="0" max="100" value="10" step="1">
            <select id="ticketPrioridade" onchange="toggleItemStatus(this)">
                <option value="0" selected>0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
        </div>

        <div class="item-container">
            <label for="base">Aum. Base Clientes: <span id="baseValue">10</span>%</label>
            <input type="range" id="base" name="base" min="0" max="100" value="10" step="1">
            <select id="basePrioridade" onchange="toggleItemStatus(this)">
                <option value="0" selected> 0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
        </div>

        <div class="item-container">
            <label for="assinantes">Crescimento Assinantes: <span id="assinantesValue">10</span>%</label>
            <input type="range" id="assinantes" name="assinantes" min="0" max="100" value="10" step="1">
            <select id="assinantesPrioridade" onchange="toggleItemStatus(this)">
                <option value="0" selected>0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
        </div>

        <div class="item-container">
            <label for="posicionamento">Posicionamento Digital: <span id="posicionamentoValue">10</span>%</label>
            <input type="range" id="posicionamento" name="posicionamento" min="0" max="100" value="10" step="1">
            <select id="posicionamentoPrioridade" onchange="toggleItemStatus(this)">
                <option value="0" selected>0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
        </div>

        <div class="item-container">
            <label for="viabilidade">Análise Viab. Lucro: <span id="viabilidadeValue">10</span>%</label>
            <input type="range" id="viabilidade" name="viabilidade" min="0" max="100" value="10" step="1">
            <select id="viabilidadePrioridade" onchange="toggleItemStatus(this)">
                <option value="0" selected>0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
				<option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
        </div>

 <div class="item-container">
        <label for="retencao">Verif. Retenção Clientes: <span id="retencaoValue">10</span>%</label>
        <input type="range" id="retencao" name="retencao" min="0" max="100" value="10" step="1">
        <select id="retencaoPrioridade" onchange="toggleItemStatus(this)">
            <option value="0" selected>0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
        </select>
    </div>

    <div class="item-container">
        <label for="processos">Produtividade e Processos: <span id="processosValue">10</span>%</label>
        <input type="range" id="processos" name="processos" min="0" max="100" value="10" step="1">
        <select id="processosPrioridade" onchange="toggleItemStatus(this)">
            <option value="0" selected>0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
        </select>
    </div>

    <div class="item-container">
        <label for="trafego">Tráfego / Site: <span id="trafegoValue">10</span>%</label>
        <input type="range" id="trafego" name="trafego" min="0" max="100" value="10" step="1">
        <select id="trafegoPrioridade" onchange="toggleItemStatus(this)">
            <option value="0" selected>0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
        </select>
    </div>
</form>

<div id="chart"></div>

<div id="calculator">
    <h2>Calculadora de Tempo Dedicado</h2>
    <label for="frequencia">Frequência das Sessões:</label>
    <select id="frequencia" name="frequencia">
        <option value="semanal">Semanal</option>
        <option value="quinzenal">Quinzenal</option>
        <option value="21dias">A cada 21 dias</option>
    </select>
    <br><br>
    <label for="horas">Horas por Sessão:</label>
    <input type="number" id="horas" name="horas" min="1" value="1">
    <br><br>
    <button onclick="calcularTempoDedicado()">Calcular Tempo Dedicado</button>
    <br><br>
    <div id="resultado"></div>
    <div id="temposPorItem">
        <h3>Tempo Dedicado por Item:</h3>
        <ul id="listaTemposPorItem" class="sortable"></ul>
    </div>
</div>
<button id="saveState">Salvar Estado</button>
<button id="loadState" onclick="document.getElementById('fileInput').click();">Carregar Estado</button>
<input type="file" id="fileInput" style="display: none;" onchange="loadStateFromFile(event)"/>
<script>
    var inputs = Array.from(document.querySelectorAll('input[type="range"]'));
    var values = Array.from(document.querySelectorAll('span'));

    inputs.forEach(function(input, index) {
        input.addEventListener('input', function() {
            updateValues(index, parseInt(this.value));
        });
    });

    function updateValues(changedIndex, changedValue) {
        var totalValue = inputs.reduce(function(sum, input, index) {
            return index === changedIndex ? sum + changedValue : sum + parseInt(input.value);
        }, 0);

        if (totalValue > 100) {
            var excessValue = totalValue - 100;
            var remainingInputs = inputs.filter(function(_, index) {
                return index !== changedIndex;
            });

            var totalRemainingValue = remainingInputs.reduce(function(sum, input) {
                return sum + parseInt(input.value);
            }, 0);

            remainingInputs.forEach(function(input, index) {
                var currentValue = parseInt(input.value);
                var newValue = Math.max(0, currentValue - Math.floor(excessValue * currentValue / totalRemainingValue));
                input.value = newValue;
                values[inputs.indexOf(input)].textContent = newValue;
            });
        }

        values[changedIndex].textContent = changedValue;
        updateChart();
    }

    function updateChart() {
    var itemContainers = Array.from(document.querySelectorAll('.item-container:not(.inactive)'));
    var labels = itemContainers.map(function(container) {
        return container.querySelector('label').textContent.split(':')[0].trim();
    });

    var data = [{
        x: labels,
        y: itemContainers.map(function(container) {
            return parseInt(container.querySelector('input[type="range"]').value);
        }),
        type: 'bar',
        text: itemContainers.map(function(container) {
    var percentage = container.querySelector('span').textContent;
    return percentage + '%';
}),

        textposition: 'auto',
        hoverinfo: 'text',
        marker: {
            color: 'rgb(158,202,225)',
            opacity: 0.6,
            line: {
                color: 'rgb(8,48,107)',
                width: 1.5
            }
        }
    }];

    var layout = {
        title: 'Distribuição de Tempo por Prioridade',
        xaxis: { title: 'Prioridades' },
        yaxis: { title: 'Percentual de Tempo Dedicado' }
    };

    Plotly.newPlot('chart', data, layout);
}


    function calcularTempoDedicado() {
    var frequencia = document.getElementById('frequencia').value;
    var horas = parseInt(document.getElementById('horas').value);
    var resultado = document.getElementById('resultado');

    var tempoMensal;
    switch (frequencia) {
        case 'semanal':
            tempoMensal = horas * 4;
            break;
        case 'quinzenal':
            tempoMensal = horas * 2;
            break;
        case '21dias':
            tempoMensal = horas * 1.5;
            break;
    }

    // Convertendo tempoMensal para horas e minutos
    var horasConvertidas = Math.floor(tempoMensal);
    var minutosConvertidos = Math.round((tempoMensal - horasConvertidas) * 60);

    resultado.innerHTML = 'Tempo dedicado mensalmente: ' + horasConvertidas + ' horas ' + minutosConvertidos + ' minutos';

    var itemContainers = Array.from(document.querySelectorAll('.item-container:not(.inactive)'));
    var temposPorItemHTML = '';
    itemContainers.forEach(function(container) {
        var input = container.querySelector('input[type="range"]');
        var percentual = parseInt(input.value);
        var tempoDedicado = (percentual / 100) * tempoMensal;

        // Convertendo tempoDedicado para horas e minutos
        var horasItem = Math.floor(tempoDedicado);
        var minutosItem = Math.round((tempoDedicado - horasItem) * 60);

        temposPorItemHTML += '<li>' + input.name + ': ' + horasItem + ' horas ' + minutosItem + ' minutos</li>';
    });

    document.getElementById('listaTemposPorItem').innerHTML = temposPorItemHTML;

    // Inicializa o Sortable.js na lista de tempos por item
    new Sortable(document.getElementById('listaTemposPorItem'), { animation: 150 });
}


    function toggleItemStatus(selectElement) {
        var itemContainer = selectElement.closest('.item-container');
        var isInactive = selectElement.value === '0';

        itemContainer.classList.toggle('inactive', isInactive);

        var input = itemContainer.querySelector('input[type="range"]');
        input.disabled = isInactive;

        if (isInactive) {
            input.value = '0';
            itemContainer.querySelector('span').textContent = '0';
        }

        updateChart();
        calcularTempoDedicado();
    }

    // Inicializa o Sortable.js nos itens do formulário
    new Sortable(document.getElementById('itemForm'), {
        animation: 150,
        onUpdate: function() {
            updateChart();
            calcularTempoDedicado();
        }
    });

    updateChart();


document.getElementById('saveState').addEventListener('click', saveStateToFile);

function saveStateToFile() {
    var state = {
        items: inputs.map(input => ({
            id: input.id,
            value: input.value,
            priority: document.getElementById(input.id + 'Prioridade').value,
            order: [...document.getElementById('itemForm').children].indexOf(input.closest('.item-container'))
        })),
        frequencia: document.getElementById('frequencia').value,
        horas: document.getElementById('horas').value
    };
    var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state));
    var dlAnchorElem = document.createElement('a');
    dlAnchorElem.setAttribute("href", dataStr);
    dlAnchorElem.setAttribute("download", "estado-aplicacao.json");
    dlAnchorElem.click();
}

function loadStateFromFile(event) {
    var file = event.target.files[0];
    if (file) {
        var reader = new FileReader();
        reader.onload = function(e) {
            var state = JSON.parse(e.target.result);
            // Primeiro, ordene os itens com base na propriedade 'order' salva.
            state.items.sort((a, b) => a.order - b.order);
            // Em seguida, atualize a ordem dos elementos no DOM.
            const itemForm = document.getElementById('itemForm');
            state.items.forEach(item => {
                const itemContainer = document.getElementById(item.id).closest('.item-container');
                itemForm.appendChild(itemContainer); // Isso move o elemento para a nova posição.
                var input = document.getElementById(item.id);
                var select = document.getElementById(item.id + 'Prioridade');
                input.value = item.value;
                select.value = item.priority;
                updateValues(inputs.indexOf(input), parseInt(item.value));
            });
            document.getElementById('frequencia').value = state.frequencia;
            document.getElementById('horas').value = state.horas;
            calcularTempoDedicado();
        };
        reader.readAsText(file);
    }
}

</script>

</body>
</html>
